import React, { useState } from 'react';
import { ArrowLeft, ArrowRight, Trophy, Users, MapPin } from 'lucide-react';

const GolfScoreApp = () => {
  const [currentScreen, setCurrentScreen] = useState('config');
  const [gameConfig, setGameConfig] = useState({
    golfName: '',
    numberOfPartners: 0,
    partnerNames: [],
    holes: 9
  });
  const [gameData, setGameData] = useState({
    currentHole: 1,
    holes: [],
    players: []
  });

  // Interface 1: Configuration
  const ConfigScreen = () => {
    const [tempConfig, setTempConfig] = useState(gameConfig);
    const [tempPartnerNames, setTempPartnerNames] = useState(['', '', '']);

    const startGame = () => {
      if (!tempConfig.golfName.trim()) return;
      
      const players = ['Arthur'];
      const validPartnerNames = tempPartnerNames.slice(0, tempConfig.numberOfPartners).filter(name => name.trim());
      players.push(...validPartnerNames);
      
      const holes = Array.from({ length: tempConfig.holes }, (_, i) => ({
        holeNumber: i + 1,
        par: 4,
        scores: players.reduce((acc, player) => ({ ...acc, [player]: 0 }), {})
      }));

      setGameConfig({
        ...tempConfig,
        partnerNames: validPartnerNames
      });
      
      setGameData({
        currentHole: 1,
        holes,
        players
      });
      
      setCurrentScreen('game');
    };

    return (
      <div className="min-h-screen bg-white p-4 flex flex-col">
        <div className="text-center mb-8">
          <h1 className="text-2xl font-bold text-gray-800 mb-2">üõ†Ô∏è Config de la partie</h1>
        </div>

        <div className="flex-1 space-y-6">
          {/* Nom du golf */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              Nom du golf *
            </label>
            <input
              type="text"
              value={tempConfig.golfName}
              onChange={(e) => setTempConfig({...tempConfig, golfName: e.target.value})}
              className="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-lg"
              placeholder="Entrez le nom du golf"
            />
          </div>

          {/* Nombre de partenaires */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-3">
              Nombre de partenaires (en plus de vous)
            </label>
            <div className="grid grid-cols-4 gap-2">
              {[0, 1, 2, 3].map(num => (
                <button
                  key={num}
                  onClick={() => setTempConfig({...tempConfig, numberOfPartners: num})}
                  className={`p-3 rounded-lg font-semibold transition-all ${
                    tempConfig.numberOfPartners === num
                      ? 'bg-blue-500 text-white shadow-lg'
                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  {num}
                </button>
              ))}
            </div>
          </div>

          {/* Noms des partenaires */}
          {tempConfig.numberOfPartners > 0 && (
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-3">
                Pr√©noms des partenaires
              </label>
              <div className="space-y-2">
                {Array.from({ length: tempConfig.numberOfPartners }, (_, i) => (
                  <input
                    key={i}
                    type="text"
                    value={tempPartnerNames[i] || ''}
                    onChange={(e) => {
                      const newNames = [...tempPartnerNames];
                      newNames[i] = e.target.value;
                      setTempPartnerNames(newNames);
                    }}
                    className="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none"
                    placeholder={`Partenaire ${i + 1}`}
                  />
                ))}
              </div>
            </div>
          )}

          {/* Nombre de trous */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-3">
              Nombre de trous
            </label>
            <div className="grid grid-cols-2 gap-4">
              {[9, 18].map(holes => (
                <button
                  key={holes}
                  onClick={() => setTempConfig({...tempConfig, holes})}
                  className={`p-4 rounded-lg font-semibold text-lg transition-all ${
                    tempConfig.holes === holes
                      ? 'bg-blue-500 text-white shadow-lg'
                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  {holes} trous
                </button>
              ))}
            </div>
          </div>
        </div>

        <button
          onClick={startGame}
          disabled={!tempConfig.golfName.trim()}
          className={`w-full py-4 rounded-lg font-semibold text-lg transition-all ${
            tempConfig.golfName.trim()
              ? 'bg-blue-500 text-white hover:bg-blue-600 shadow-lg'
              : 'bg-gray-300 text-gray-500 cursor-not-allowed'
          }`}
        >
          Commencer la partie
        </button>
      </div>
    );
  };

  // Interface 2: Jeu
  const GameScreen = () => {
    const currentHoleData = gameData.holes[gameData.currentHole - 1];
    
    const updatePar = (par) => {
      const newHoles = [...gameData.holes];
      newHoles[gameData.currentHole - 1].par = par;
      setGameData({...gameData, holes: newHoles});
    };

    const updateScore = (player, score) => {
      const newHoles = [...gameData.holes];
      newHoles[gameData.currentHole - 1].scores[player] = score;
      setGameData({...gameData, holes: newHoles});
    };

    const getScoreIcon = (score, par) => {
      const diff = score - par;
      if (score === 0) return '';
      if (diff <= -2) return 'üü°'; // Eagle ou mieux
      if (diff === -1) return 'üü¢'; // Birdie
      if (diff === 0) return '‚ö™'; // Par
      if (diff === 1) return 'üî¥'; // Bogey
      return '‚ö´'; // Double bogey ou pire
    };

    const getScoreText = (score, par) => {
      if (score === 0) return '';
      const diff = score - par;
      if (diff === 0) return 'E';
      return diff > 0 ? `+${diff}` : `${diff}`;
    };

    const getTotalScore = (player) => {
      let total = 0;
      let totalPar = 0;
      gameData.holes.slice(0, gameData.currentHole).forEach(hole => {
        if (hole.scores[player] > 0) {
          total += hole.scores[player];
          totalPar += hole.par;
        }
      });
      const diff = total - totalPar;
      if (diff === 0) return 'E';
      return diff > 0 ? `+${diff}` : `${diff}`;
    };

    const nextHole = () => {
      if (gameData.currentHole < gameData.holes.length) {
        setGameData({...gameData, currentHole: gameData.currentHole + 1});
      } else {
        setCurrentScreen('summary');
      }
    };

    const previousHole = () => {
      if (gameData.currentHole > 1) {
        setGameData({...gameData, currentHole: gameData.currentHole - 1});
      }
    };

    return (
      <div className="min-h-screen bg-white p-4 flex flex-col">
        {/* En-t√™te fixe avec scores */}
        <div className="bg-gray-50 rounded-lg p-4 mb-4">
          <h1 className="text-xl font-bold text-center text-gray-800 mb-3">
            ‚õ≥ Carte des scores
          </h1>
          <div className="flex justify-between text-center">
            {gameData.players.map(player => (
              <div key={player} className="flex-1">
                <div className="font-semibold text-gray-800 text-sm">{player}</div>
                <div className="text-lg font-bold text-blue-600">{getTotalScore(player)}</div>
              </div>
            ))}
          </div>
        </div>

        {/* Trou actuel */}
        <div className="flex-1">
          <div className="text-center mb-6">
            <h2 className="text-2xl font-bold text-gray-800">
              Trou {gameData.currentHole}
            </h2>
          </div>

          {/* S√©lection du par */}
          <div className="mb-6">
            <label className="block text-sm font-semibold text-gray-700 mb-3 text-center">
              Par du trou
            </label>
            <div className="flex justify-center gap-4">
              {[3, 4, 5].map(par => (
                <button
                  key={par}
                  onClick={() => updatePar(par)}
                  className={`w-16 h-16 rounded-full font-bold text-xl transition-all ${
                    currentHoleData.par === par
                      ? 'bg-green-500 text-white shadow-lg'
                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  {par}
                </button>
              ))}
            </div>
          </div>

          {/* Scores des joueurs */}
          <div className="space-y-4">
            {gameData.players.map(player => (
              <div key={player} className="bg-gray-50 rounded-lg p-4">
                <div className="flex items-center justify-between mb-3">
                  <span className="font-semibold text-gray-800">{player}</span>
                  <div className="flex items-center gap-2">
                    <span className="text-2xl">
                      {getScoreIcon(currentHoleData.scores[player], currentHoleData.par)}
                    </span>
                    <span className="font-bold text-lg">
                      {getScoreText(currentHoleData.scores[player], currentHoleData.par)}
                    </span>
                  </div>
                </div>
                <div className="flex gap-2 justify-center">
                  {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(score => (
                    <button
                      key={score}
                      onClick={() => updateScore(player, score)}
                      className={`w-10 h-10 rounded-full font-semibold transition-all ${
                        currentHoleData.scores[player] === score
                          ? 'bg-blue-500 text-white shadow-lg'
                          : 'bg-white border-2 border-gray-200 text-gray-700 hover:border-blue-300'
                      }`}
                    >
                      {score}
                    </button>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </div>

        {/* Boutons de navigation */}
        <div className="flex gap-4 mt-6">
          <button
            onClick={previousHole}
            disabled={gameData.currentHole === 1}
            className={`flex-1 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 ${
              gameData.currentHole === 1
                ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                : 'bg-gray-500 text-white hover:bg-gray-600'
            }`}
          >
            <ArrowLeft size={20} />
            Retour
          </button>
          <button
            onClick={nextHole}
            className="flex-1 py-3 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 flex items-center justify-center gap-2"
          >
            {gameData.currentHole === gameData.holes.length ? 'Terminer' : 'Trou suivant'}
            <ArrowRight size={20} />
          </button>
        </div>
      </div>
    );
  };

  // Interface 3: R√©sum√©
  const SummaryScreen = () => {
    const today = new Date().toLocaleDateString('fr-FR');
    
    const getFinalScore = (player) => {
      let total = 0;
      let totalPar = 0;
      gameData.holes.forEach(hole => {
        total += hole.scores[player];
        totalPar += hole.par;
      });
      return total - totalPar;
    };

    const getWinner = () => {
      const scores = gameData.players.map(player => ({
        player,
        score: getFinalScore(player)
      }));
      
      const minScore = Math.min(...scores.map(s => s.score));
      const winners = scores.filter(s => s.score === minScore);
      
      if (winners.length > 1) {
        return { type: 'tie', players: winners.map(w => w.player) };
      } else {
        return { type: 'winner', player: winners[0].player, score: minScore };
      }
    };

    const winner = getWinner();

    return (
      <div className="min-h-screen bg-white p-4">
        <div className="text-center mb-6">
          <h1 className="text-xl font-bold text-gray-800">
            üìÖ Partie du {today} au Golf {gameConfig.golfName}
          </h1>
        </div>

        <div className="border-4 border-green-800 rounded-lg p-6 bg-green-50">
          {/* R√©sultat final */}
          <div className="text-center mb-6">
            {winner.type === 'tie' ? (
              <div>
                <Trophy className="mx-auto text-yellow-600 mb-2" size={32} />
                <h2 className="text-xl font-bold text-green-800">√âgalit√© !</h2>
                <p className="text-green-700">
                  {winner.players.join(' et ')} se partagent la victoire
                </p>
              </div>
            ) : (
              <div>
                <Trophy className="mx-auto text-yellow-600 mb-2" size={32} />
                <h2 className="text-xl font-bold text-green-800">
                  Gagnant : {winner.player}
                </h2>
                <p className="text-green-700">
                  Score final : {winner.score === 0 ? 'E' : winner.score > 0 ? `+${winner.score}` : `${winner.score}`}
                </p>
              </div>
            )}
          </div>

          {/* Tableau des scores */}
          <div className="bg-white rounded-lg p-4 shadow-inner">
            <h3 className="font-bold text-green-800 mb-4 text-center">Tableau final des scores</h3>
            
            {/* En-t√™tes */}
            <div className="grid grid-cols-4 gap-1 mb-2 text-xs font-semibold text-center">
              <div className="text-green-800">Trou</div>
              {gameData.players.slice(0, 3).map(player => (
                <div key={player} className="text-green-800 truncate">{player}</div>
              ))}
            </div>

            {/* Scores par trou */}
            <div className="space-y-1 max-h-64 overflow-y-auto">
              {gameData.holes.map(hole => (
                <div key={hole.holeNumber}>
                  <div className="grid grid-cols-4 gap-1 text-xs text-center py-1">
                    <div className="font-semibold text-green-800">{hole.holeNumber}</div>
                    {gameData.players.slice(0, 3).map(player => {
                      const score = hole.scores[player];
                      const diff = score - hole.par;
                      return (
                        <div key={player} className="text-green-700">
                          {diff === 0 ? 'E' : diff > 0 ? `+${diff}` : `${diff}`}
                        </div>
                      );
                    })}
                  </div>
                  <div className="grid grid-cols-4 gap-1 text-xs text-center text-gray-500 mb-1">
                    <div>Par {hole.par}</div>
                    {gameData.players.slice(0, 3).map(player => (
                      <div key={player}>{hole.scores[player]}</div>
                    ))}
                  </div>
                </div>
              ))}
            </div>

            {/* Totaux finaux */}
            <div className="border-t-2 border-green-200 mt-4 pt-2">
              <div className="grid grid-cols-4 gap-1 text-sm font-bold text-center">
                <div className="text-green-800">Total</div>
                {gameData.players.slice(0, 3).map(player => {
                  const finalScore = getFinalScore(player);
                  return (
                    <div key={player} className="text-green-800">
                      {finalScore === 0 ? 'E' : finalScore > 0 ? `+${finalScore}` : `${finalScore}`}
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        </div>

        <button
          onClick={() => {
            setCurrentScreen('config');
            setGameConfig({
              golfName: '',
              numberOfPartners: 0,
              partnerNames: [],
              holes: 9
            });
            setGameData({
              currentHole: 1,
              holes: [],
              players: []
            });
          }}
          className="w-full mt-6 py-3 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600"
        >
          Nouvelle partie
        </button>
      </div>
    );
  };

  return (
    <div className="max-w-sm mx-auto">
      {currentScreen === 'config' && <ConfigScreen />}
      {currentScreen === 'game' && <GameScreen />}
      {currentScreen === 'summary' && <SummaryScreen />}
    </div>
  );
};

export default GolfScoreApp;
